<!doctype html>
<html lang="pt-BR">

<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Inscreva-se | Innova Digital</title>
    <link href="https://fonts.googleapis.com/css2?family=Manrope:wght@400;500;600;700;800&display=swap"
        rel="stylesheet">
    <style>
        *,
        *::before,
        *::after {
            box-sizing: border-box;
            margin: 0;
            padding: 0
        }

        html {
            -webkit-text-size-adjust: 100%
        }

        body {
            font-family: 'Manrope', system-ui, -apple-system, sans-serif;
            background: #0d1b2a;
            color: #e2e8f0;
            min-height: 100dvh;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            padding: 24px 16px;
            line-height: 1.6;
        }

        .container {
            width: 100%;
            max-width: 520px;
            text-align: center;
        }

        .logo {
            width: 72px;
            height: 72px;
            border-radius: 18px;
            object-fit: cover;
            margin-bottom: 28px;
            box-shadow: 0 4px 24px rgba(0, 0, 0, .4);
        }

        h1 {
            font-size: 1.6rem;
            font-weight: 800;
            margin-bottom: 10px;
            color: #fff;
            line-height: 1.3;
        }

        .subcopy {
            font-size: .95rem;
            color: #94a3b8;
            margin-bottom: 32px;
            line-height: 1.6;
        }

        .subcopy span {
            color: #60a5fa;
            font-weight: 600;
        }

        .card {
            background: rgba(255, 255, 255, .04);
            border: 1px solid rgba(255, 255, 255, .08);
            border-radius: 16px;
            padding: 28px 24px;
            backdrop-filter: blur(12px);
            text-align: left;
        }

        label {
            display: block;
            font-size: .8rem;
            font-weight: 600;
            color: #94a3b8;
            margin-bottom: 6px;
            text-transform: uppercase;
            letter-spacing: .04em;
        }

        input[type="text"],
        input[type="email"],
        input[type="tel"] {
            display: block;
            width: 100%;
            padding: 14px 16px;
            font-size: 16px;
            font-family: inherit;
            color: #fff;
            background: rgba(255, 255, 255, .06);
            border: 1px solid rgba(255, 255, 255, .12);
            border-radius: 10px;
            outline: none;
            transition: border-color .2s, box-shadow .2s;
            -webkit-appearance: none;
            appearance: none;
        }

        input::placeholder {
            color: #475569
        }

        input:focus {
            border-color: #3b82f6;
            box-shadow: 0 0 0 3px rgba(59, 130, 246, .15);
        }

        .field {
            margin-bottom: 18px
        }

        .field:last-of-type {
            margin-bottom: 24px
        }

        .hp {
            position: absolute;
            left: -9999px;
            opacity: 0;
            height: 0;
            width: 0;
            overflow: hidden;
            pointer-events: none
        }

        button {
            display: block;
            width: 100%;
            padding: 16px;
            font-size: 1rem;
            font-weight: 700;
            font-family: inherit;
            color: #0d1b2a;
            background: #facc15;
            border: none;
            border-radius: 10px;
            cursor: pointer;
            transition: background .2s, transform .1s, opacity .2s;
            letter-spacing: .01em;
        }

        button:hover {
            background: #fde047;
            transform: translateY(-1px)
        }

        button:active {
            transform: translateY(0)
        }

        button:disabled {
            opacity: .5;
            cursor: not-allowed;
            transform: none
        }

        .alert {
            padding: 12px 16px;
            border-radius: 10px;
            font-size: .85rem;
            margin-bottom: 18px;
            display: none;
            text-align: left;
            outline: none;
        }

        .alert-success {
            background: rgba(16, 185, 129, .12);
            color: #6ee7b7;
            border: 1px solid rgba(16, 185, 129, .25)
        }

        .alert-error {
            background: rgba(239, 68, 68, .12);
            color: #fca5a5;
            border: 1px solid rgba(239, 68, 68, .25)
        }

        .alert.show {
            display: block
        }

        .footer {
            margin-top: 24px;
            font-size: .75rem;
            color: #475569;
        }

        .footer a {
            color: #60a5fa;
            text-decoration: none;
        }

        .footer a:hover {
            text-decoration: underline
        }
    </style>
</head>

<body>
    <div class="container">
        <img src="/logo.png" alt="Innova Digital" class="logo">
        <h1>Receba novidades do VAPApp</h1>
        <p class="subcopy">Inscreva-se para receber mais informa√ß√µes do aplicativo <span>VAPApp</span> no WhatsApp.
            Deixe seu nome, e-mail e n√∫mero abaixo.</p>

        <div class="card">
            <div id="alertBox" class="alert" role="status" aria-live="polite" tabindex="-1"></div>

            <form id="signupForm" novalidate>

                <div class="hp" aria-hidden="true">
                    <label for="website_field">N√£o preencha</label>
                    <input type="text" id="website_field" name="website_field" tabindex="-1" autocomplete="off">
                </div>

                <div class="field">
                    <label for="nome">Nome</label>
                    <input type="text" id="nome" name="nome" placeholder="Seu nome completo" required
                        autocomplete="name">
                </div>

                <div class="field">
                    <label for="email">E-mail</label>
                    <input type="email" id="email" name="email" placeholder="seu@email.com" required
                        autocomplete="email">
                </div>

                <div class="field">
                    <label for="whatsapp">WhatsApp</label>
                    <input type="tel" id="whatsapp" name="whatsapp" placeholder="(11) 91234-5678" required
                        autocomplete="tel" inputmode="numeric">
                </div>

                <button type="submit" id="btnSubmit">Garantir minha vaga</button>
            </form>
        </div>

        <p class="footer">
            <a href="/">‚Üê Voltar para o site</a> ¬∑ Innova Digital
        </p>
    </div>

    <script>
        (function () {
            'use strict';

            // ===== CONFIG =====
            const WEBHOOK_URL = 'https://web.ferhost.com.br/webhook/form';
            const TIMEOUT_MS = 20000;
            const COOLDOWN_MS = 15000;
            const SOURCE_TAG = 'landing_vapapp';

            // ===== DOM =====
            const form = document.getElementById('signupForm');
            const btn = document.getElementById('btnSubmit');
            const alertBox = document.getElementById('alertBox');
            const whatsappInput = document.getElementById('whatsapp');
            const honeypot = document.getElementById('website_field');
            const originalCTA = btn.textContent;

            let lastSubmitTime = 0;

            // ===== M√ÅSCARA WHATSAPP =====
            function onlyDigits(v) { return v.replace(/\D/g, ''); }

            function maskPhone(v) {
                var d = onlyDigits(v).slice(0, 11);
                if (d.length === 0) return '';
                if (d.length <= 2) return '(' + d;
                if (d.length <= 6) return '(' + d.slice(0, 2) + ') ' + d.slice(2);
                if (d.length <= 10) return '(' + d.slice(0, 2) + ') ' + d.slice(2, 6) + '-' + d.slice(6);
                return '(' + d.slice(0, 2) + ') ' + d.slice(2, 7) + '-' + d.slice(7, 11);
            }

            whatsappInput.addEventListener('input', function () {
                var pos = this.selectionStart;
                var before = this.value.length;
                this.value = maskPhone(this.value);
                var after = this.value.length;
                this.setSelectionRange(pos + (after - before), pos + (after - before));
            });

            // ===== ALERTAS =====
            function showAlert(msg, type) {
                alertBox.className = 'alert alert-' + type + ' show';
                alertBox.setAttribute('role', type === 'error' ? 'alert' : 'status');
                alertBox.textContent = msg;
                alertBox.focus();
            }

            function hideAlert() {
                alertBox.className = 'alert';
                alertBox.textContent = '';
            }

            // ===== VALIDA√á√ÉO =====
            function validate() {
                var nome = document.getElementById('nome').value.trim();
                var email = document.getElementById('email').value.trim();
                var digits = onlyDigits(whatsappInput.value);

                if (nome.length < 2) {
                    showAlert('Por favor, informe seu nome (m√≠nimo 2 caracteres).', 'error');
                    document.getElementById('nome').focus();
                    return null;
                }
                if (!/.+@.+\..+/.test(email)) {
                    showAlert('Por favor, informe um e-mail v√°lido.', 'error');
                    document.getElementById('email').focus();
                    return null;
                }
                if (digits.length < 10 || digits.length > 11) {
                    showAlert('Por favor, informe um WhatsApp v√°lido (10 ou 11 d√≠gitos).', 'error');
                    whatsappInput.focus();
                    return null;
                }
                return { nome: nome, email: email, whatsapp_digits: digits, whatsapp_masked: whatsappInput.value };
            }

            // ===== ESTRAT√âGIA 1: fetch com CORS (ideal) =====
            async function sendJSON(payload) {
                console.log('[FORM] üîµ Tentativa 1: fetch JSON com CORS');
                const controller = new AbortController();
                const timer = setTimeout(function () { controller.abort(); }, TIMEOUT_MS);

                try {
                    const resp = await fetch(WEBHOOK_URL, {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify(payload),
                        signal: controller.signal
                    });
                    clearTimeout(timer);
                    console.log('[FORM] ‚úÖ JSON com CORS ‚Äî status:', resp.status);
                    return resp.ok ? 'ok' : 'fail';
                } catch (err) {
                    clearTimeout(timer);
                    console.warn('[FORM] ‚ö†Ô∏è JSON com CORS falhou:', err.message || err);
                    return 'cors_error';
                }
            }

            // ===== ESTRAT√âGIA 2: fetch no-cors form-urlencoded (bypass CORS) =====
            async function sendNoCors(payload) {
                console.log('[FORM] üü° Tentativa 2: fetch no-cors form-urlencoded (bypass CORS)');
                const controller = new AbortController();
                const timer = setTimeout(function () { controller.abort(); }, TIMEOUT_MS);

                var body = new URLSearchParams();
                body.set('nome', payload.nome);
                body.set('email', payload.email);
                body.set('whatsapp', payload.whatsapp_digits);
                body.set('whatsapp_masked', payload.whatsapp_masked);
                body.set('source', payload.source);
                body.set('page_url', payload.page_url);
                body.set('ts', payload.ts);

                try {
                    await fetch(WEBHOOK_URL, {
                        method: 'POST',
                        mode: 'no-cors',
                        headers: { 'Content-Type': 'application/x-www-form-urlencoded' },
                        body: body.toString(),
                        signal: controller.signal
                    });
                    clearTimeout(timer);
                    // mode: 'no-cors' retorna resposta opaca (status 0)
                    // Se n√£o houve exce√ß√£o, os dados FORAM enviados
                    console.log('[FORM] ‚úÖ no-cors enviado (resposta opaca ‚Äî dados enviados com sucesso)');
                    return 'ok';
                } catch (err) {
                    clearTimeout(timer);
                    console.error('[FORM] ‚ùå no-cors tamb√©m falhou:', err.message || err);
                    return 'fail';
                }
            }

            // ===== ESTRAT√âGIA 3: form POST nativo via iframe oculto (√∫ltimo recurso) =====
            function sendFormPost(payload) {
                console.log('[FORM] üî¥ Tentativa 3: form POST nativo via iframe oculto');
                return new Promise(function (resolve) {
                    // Criar iframe tempor√°rio
                    var iframe = document.createElement('iframe');
                    iframe.name = 'webhookFallback_' + Date.now();
                    iframe.style.cssText = 'display:none;width:0;height:0;border:0';
                    document.body.appendChild(iframe);

                    // Criar form tempor√°rio
                    var tempForm = document.createElement('form');
                    tempForm.method = 'POST';
                    tempForm.action = WEBHOOK_URL;
                    tempForm.target = iframe.name;
                    tempForm.style.display = 'none';

                    // Adicionar campos
                    var fields = {
                        nome: payload.nome,
                        email: payload.email,
                        whatsapp: payload.whatsapp_digits,
                        whatsapp_masked: payload.whatsapp_masked,
                        source: payload.source,
                        page_url: payload.page_url,
                        ts: payload.ts
                    };
                    for (var key in fields) {
                        var input = document.createElement('input');
                        input.type = 'hidden';
                        input.name = key;
                        input.value = fields[key];
                        tempForm.appendChild(input);
                    }

                    document.body.appendChild(tempForm);

                    // Timeout de seguran√ßa
                    var done = false;
                    var timeout = setTimeout(function () {
                        if (!done) {
                            done = true;
                            console.log('[FORM] ‚úÖ form POST enviado (timeout ‚Äî assumindo sucesso)');
                            cleanup();
                            resolve('ok');
                        }
                    }, 5000);

                    iframe.addEventListener('load', function () {
                        if (!done) {
                            done = true;
                            clearTimeout(timeout);
                            console.log('[FORM] ‚úÖ form POST ‚Äî iframe carregou');
                            cleanup();
                            resolve('ok');
                        }
                    });

                    function cleanup() {
                        try { document.body.removeChild(iframe); } catch (e) { }
                        try { document.body.removeChild(tempForm); } catch (e) { }
                    }

                    tempForm.submit();
                });
            }

            // ===== SUBMIT =====
            form.addEventListener('submit', async function (e) {
                e.preventDefault();
                hideAlert();

                // Honeypot
                if (honeypot && honeypot.value) {
                    console.log('[FORM] üö´ Honeypot ativado ‚Äî envio bloqueado');
                    return;
                }

                // Anti-spam: cooldown de 15s
                var now = Date.now();
                if (now - lastSubmitTime < COOLDOWN_MS) {
                    var wait = Math.ceil((COOLDOWN_MS - (now - lastSubmitTime)) / 1000);
                    showAlert('Aguarde ' + wait + 's antes de enviar novamente.', 'error');
                    return;
                }

                // Valida√ß√£o
                var data = validate();
                if (!data) return;

                // Montar payload
                var payload = {
                    nome: data.nome,
                    email: data.email,
                    whatsapp_digits: data.whatsapp_digits,
                    whatsapp_masked: data.whatsapp_masked,
                    source: SOURCE_TAG,
                    page_url: window.location.href,
                    ts: new Date().toISOString()
                };

                console.log('[FORM] üì¶ Payload:', JSON.stringify(payload, null, 2));

                // Loading
                btn.disabled = true;
                btn.textContent = 'Enviando‚Ä¶';
                lastSubmitTime = Date.now();

                // ===== CADEIA DE TENTATIVAS =====
                var result;

                // 1) Tenta JSON com CORS
                result = await sendJSON(payload);

                // 2) Se CORS falhou, tenta no-cors form-urlencoded
                if (result === 'cors_error') {
                    result = await sendNoCors(payload);
                }

                // 3) Se tudo falhou, tenta form POST nativo
                if (result === 'fail') {
                    result = await sendFormPost(payload);
                }

                // Resultado
                btn.disabled = false;
                btn.textContent = originalCTA;

                if (result === 'ok') {
                    console.log('[FORM] üéâ Envio conclu√≠do com sucesso!');
                    showAlert('Inscri√ß√£o realizada com sucesso! Voc√™ receber√° as novidades no WhatsApp.', 'success');
                    form.reset();
                } else {
                    console.error('[FORM] ‚ùå Todas as tentativas falharam.');
                    showAlert('N√£o foi poss√≠vel enviar. Verifique sua conex√£o e tente novamente.', 'error');
                    lastSubmitTime = 0;
                }
            });
        })();
    </script>
</body>

</html>